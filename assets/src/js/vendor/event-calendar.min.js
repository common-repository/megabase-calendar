!function(t){let e=function(t,e){return e=e||null,moment(t,e).locale("en")};var o=t.fn.datepicker.noConflict();t.fn.megacalDatepicker=o,t.widget("mdb.eventCalendar",{options:{showAdd:!0,showImage:!1,showLegends:!0,showTooltipActions:!0,showOwners:!1,sliderWidth:"200px",showSlider:!0,eventClass:"height-36",eventImageSize:"square",slider:{id:"mega-toolbar-slider",min:18,max:90,value:18,step:18},classes:{megaCalendarWrap:"megaCalendarWrap","mega-content":"mega-content","mega-toolbar":"mega-toolbar","mega-toolbar-add-event":"mega-toolbar-add-event","mega-toolbar-select-month":"mega-toolbar-select-month","mega-toolbar-prev":"mega-toolbar-prev","mega-toolbar-next":"mega-toolbar-next","mega-toolbar-month":"mega-toolbar-month","mega-toolbar-slider":"mega-toolbar-slider","mega-view":"mega-view","mega-view-header":"mega-view-header","mega-view-header-weekday":"mega-view-header-weekday","mega-view-body":"mega-view-body","mega-view-week":"mega-view-week","mega-view-day":"mega-view-day","mega-view-day-header":"mega-view-day-header","mega-view-day-content":"mega-view-day-content","mega-view-day-content-event":"mega-view-day-content-event","mega-view-day-content-event-text":"mega-view-day-content-event-text","mega-view-day-content-event-image":"mega-view-day-content-event-image","mega-loading-animation":"mega-loading-animation","mega-legend":"mega-legend","mega-legend-header":"mega-legend-header","mega-legend-body":"mega-legend-body","mega-legend-items":"mega-legend-items","mega-legend-item":"mega-legend-item","mega-tooltip":"mega-tooltip"},dateFormat:{toolbar:"MMMM YYYY",calendar:"DD",calendarFirst:"MMM DD",eventDate:"MM-DD-YYYY"},colorOverride:{eventBGColor:"",eventBGOpacity:"",eventTextColor:"",eventBorderColor:"",navigationBtnColor:"",navigationBtnTextColor:""},timeFormat:"HH:mm",shortWeekdaysName:!0,loaderImageUrl:null,defaultEventImageUrl:null,calendarCreate:null,calendarAddEvent:null,calendarViewChange:null},showLoader:function(){this._removeClass(this.calendarLoader,"mega-loading-animation","hidden")._addClass(this.calendarLoader,"mega-loading-animation","visible")},hideLoader:function(){this.eventLoaderInterval&&clearInterval(this.eventLoaderInterval),void 0!==this.eventProcessingDone?this.eventLoaderInterval=setInterval(function(){!0===this.eventProcessingDone&&(clearInterval(this.eventLoaderInterval),this._hideLoader())}.bind(this),100):this._hideLoader()},showPopup:function(e){const o=this.events.filter((function(t){return t.attr("id")===`event-${e}`}))[0];this._hideTooltip();const n=t("div.arrow-zone",this.tooltip);n.hasClass("top")&&this._removeClass(n,"top")._addClass(n,"bottom"),this.tooltip.show();const a=this.tooltip.find("div.megaToolContent");this._removeClass(a,"megaToolContent","visible")._addClass(a,"megaToolContent","hidden");const i=this.tooltip.find("div.animation");this._removeClass(i,"animation","hidden")._addClass(i,"animation","visible");const s=t=>{this._removeClass(n,"top bottom"),t.originalPlacement!==t.placement?this._addClass(n,t.placement):this._addClass(n,t.originalPlacement)},d={placement:"bottom",modifiers:{preventOverflow:{boundariesElement:this.content.get(0)},arrow:{element:".arrow"}},eventsEnabled:!0,onCreate:s,onUpdate:s};this.popper=new Popper(o,this.tooltip,d)},setEvent:function(t){const e=this.tooltip.find("div.animation");this._removeClass(e,"animation","visible")._addClass(e,"animation","hidden"),this._createTooltipContent(t)},clear:function(){this.calendarBody.remove(),this.toolbarMonth.html(this.startOfMonth.format(this.options.dateFormat.toolbar)),this._processCalendarBody()},refresh:function(){this._refresh()},refreshTooltip:function(){this.popper.update()},showImage:function(t){this.options.showImage=t},_create:function(){this.widgetEventPrefix="eventcalendar.",this.now=e(),this.startOfMonth=this._getStartOfMonth(this.now),this.endOfMonth=this._getEndOfMonth(this.now),this._addClass(this.element,"megaCalendarWrap postbox"),this.content=t("<div/>"),this.content.appendTo(this.element),this._addClass(this.content,"mega-content"),this._processToolbar(),this._processCalendarView(),this._processCalendarLoader(),this.options.showLegends&&this._processLegend(),this._processTooltip(),this._trigger("calendarCreate",null,{widget:this})},_setOption:function(e,o){"events"===e&&o.events&&(this.eventsData=o.events.reverse(),this.eventProcessingInterval&&clearInterval(this.eventProcessingInterval),this.events=[],this.eventProcessingDone=!1,this.options.showSlider?this.eventCurrentClass=`height-${t(this.toolbarSlider).val()}`:this.eventCurrentClass=this.options.eventClass,this.clear(),this.eventProcessingInterval=setInterval(function(){this.eventsData&&0==this.eventsData.length&&(clearInterval(this.eventProcessingInterval),this.eventProcessingDone=!0);const t=[];let e=0;for(;10!==e&&0!=this.eventsData.length;){const o=this.eventsData.pop();e++,t.push(o)}this._processEvents(t)}.bind(this),300))},_processToolbar:function(){this.toolbar=t("<div/>"),this._addClass(this.toolbar,"mega-toolbar"),this.toolbar.appendTo(this.content),this._processToolbarButtons(),this._processToolbarMonth(),this._processToolbarSlider()},_processToolbarButtons:function(){!0===this.options.showAdd&&this._processAddEventButton(),this._processSelectMonthButton(),this._processPrevButton(),this._processNextButton()},_processAddEventButton:function(){this.addEvent=t('\n\t\t\t\t\t<button>\n\t\t\t\t\t\t<i class="fui-plus" aria-hidden="true"></i>\n\t\t\t\t\t\tAdd Event\n\t\t\t\t\t</button>\n\t\t\t\t'),this._addClass(this.addEvent,"mega-toolbar-add-event","mega-toolbar-button","button","mega-toolbar-button","page-title-action"),this.addEvent.appendTo(this.toolbar),this.addEvent.attr("title","Add an Event, or click on any date directly"),this.addEvent.on("click",function(t){this._trigger("calendarAddEvent",t,{date:new Date})}.bind(this))},_processSelectMonthButton:function(){let o=this;this.selectMonth=t('\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="input-group-addon">\n\t\t\t\t\t\t\t<i class="fui-calendar-solid" aria-hidden="true"></i>\n\t\t\t\t\t\t\tJump to&hellip;\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'),this._addClass(this.selectMonth,"mega-toolbar-select-month","mega-toolbar-button input-group date"),this._hoverOverride(this.selectMonth),this.selectMonth.appendTo(this.toolbar),this.selectMonth.attr("title","Select a month to view in the calendar"),this.selectMonth.attr("tabindex",0),this.selectMonth.megacalDatepicker({startView:"months",minViewMode:"months",todayBtn:"linked",autoclose:!0}),this.selectMonth.megacalDatepicker("setDate",this.startOfMonth.toDate()),this.selectMonth.megacalDatepicker().on("changeDate",function(t){const o=t.date,n=e(o);this.startOfMonth=this._getStartOfMonth(n),this.endOfMonth=this._getEndOfMonth(n),this._refresh(t)}.bind(this)),this.selectMonth.megacalDatepicker().on("show",(function(e){const o=t("div.datepicker"),n=o.offset();o.offset({top:n.top+30,left:n.left+20})})),this.selectMonth.on("keyup",(function(t){"Enter"==t.key&&o.selectMonth.megacalDatepicker("show")}))},_processPrevButton:function(){this.prev=t('\n\t\t\t\t\t<button>\n\t\t\t\t\t\t<i class="fui-arrow-left" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t'),this._addClass(this.prev,"mega-toolbar-prev","mega-toolbar-button mega-toolbar-nav"),this.prev.appendTo(this.toolbar),this.prev.attr("title","Move to previous month"),this.prev.attr("tabindex",0),this._hoverOverride(this.prev),this.prev.on("click",function(t){this.endOfMonth=this.startOfMonth.subtract(1,"day"),this.startOfMonth=this._getStartOfMonth(this.endOfMonth),this._refresh(t)}.bind(this))},_processNextButton:function(){this.next=t('\n\t\t\t\t\t<button>\n\t\t\t\t\t\t<i class="fui-arrow-right" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t'),this._addClass(this.next,"mega-toolbar-next","mega-toolbar-button mega-toolbar-nav"),this.next.appendTo(this.toolbar),this.next.attr("title","Move to next month"),this.next.attr("tabindex",0),this._hoverOverride(this.next),this.next.on("click",function(t){this.startOfMonth=this.endOfMonth.add(1,"day"),this.endOfMonth=this._getEndOfMonth(this.startOfMonth),this._refresh(t)}.bind(this))},_processToolbarMonth:function(){this.toolbarMonth=t("<div/>"),this._addClass(this.toolbarMonth,"mega-toolbar-month"),this.toolbarMonth.attr("tabindex",0),this.toolbarMonth.appendTo(this.toolbar),this.toolbarMonth.html(this.startOfMonth.format(this.options.dateFormat.toolbar))},_hoverOverride:function(t){this.options.colorOverride.navigationBtnColor&&(t.on("mouseenter focus",(e=>{t.css({"background-color":this.options.colorOverride.navigationBtnColor,color:this.options.colorOverride.navigationBtnTextColor})})),t.on("mouseleave blur",(e=>{t.css({"background-color":"",color:""})})))},_processToolbarSlider:function(){if(this.options.showSlider){const o=t("<div />");o.appendTo(this.toolbar),this._addClass(o,"mega-toolbar-slider"),o.css("width",this.options.sliderWidth);var e=t('<label class="sr-only" for="mega-toolbar-slider">Event Height</label>');this.toolbarSlider=t('<input type="range"/>'),this.toolbarSlider.attr({...this.options.slider}),this.toolbarSlider.appendTo(o),e.appendTo(o);const n=this;t(this.toolbarSlider).rangeslider({polyfill:!1,onSlideEnd:function(t,e){const o=`height-${e}`;n.events.forEach((function(t){n._removeClass(t,"mega-view-day-content-event",n.eventCurrentClass)._addClass(t,"mega-view-day-content-event",o)})),n.eventCurrentClass=o}})}},_processCalendarView:function(){this.view=t("<div/>"),this._addClass(this.view,"mega-view"),this.view.appendTo(this.content),this._processCalendarHeader(),this._processCalendarBody()},_processCalendarHeader:function(){this.calendarHeader=t("<div/>"),this._addClass(this.calendarHeader,"mega-view-header"),this.calendarHeader.appendTo(this.view);const e=this.options.shortWeekdaysName?moment.weekdaysShort():moment.weekdays();this.weekdays=e.map(function(e,o){const n=t("<div/>");return this._addClass(n,"mega-view-header-weekday"),n.appendTo(this.calendarHeader),n.html(e),n}.bind(this))},_processCalendarBody:function(){this.calendarBody=t("<div/>"),this._addClass(this.calendarBody,"mega-view-body"),this.calendarBody.appendTo(this.view);const e=this._getCalendarDates();this.days=[];let o=[];for(let t=0;t<e.length;t++){const n=e[t];o.push(n),(t+1)%7==0&&(this._processWeek(o),o=[])}},_processWeek:function(e){const o=t("<div/>");this._addClass(o,"mega-view-week"),o.appendTo(this.calendarBody);const n=e.map(function(e,n){const a=t("<div/>");this.now.isSame(e,"day")?this._addClass(a,"mega-view-day","today"):this._addClass(a,"mega-view-day"),a.appendTo(o),a.data("date",e.toDate());const i=t("<div/>");this._addClass(i,"mega-view-day-header"),i.appendTo(a);const s=1===e.date()?this.options.dateFormat.calendarFirst:this.options.dateFormat.calendar;i.html(e.format(s));const d=t("<div />");return this._addClass(d,"mega-view-day-content"),this.options.showAdd?(this._addClass(d,"mega-view-day-content","current-month show-add"),d.attr("title","Add event for "+e.format("MMMM Do"))):(this._addClass(d,"mega-view-day-content","current-month"),d.attr("title",e.format("MMMM Do"))),d.attr("tabindex",0),d.on("keyup",(function(e){"Enter"===e.key&&t(this).trigger("click")})),d.appendTo(a),!0===this.options.showAdd&&(i.on("click",function(t){this._trigger("calendarAddEvent",t,{date:e.toDate()})}.bind(this)),d.on("click",function(t){this._trigger("calendarAddEvent",t,{date:e.toDate()})}.bind(this))),a}.bind(this));this.days.push(...n)},_processCalendarLoader:function(){if(this.calendarLoader=t("<div/>"),this._addClass(this.calendarLoader,"mega-loading-animation","hidden"),this.calendarLoader.appendTo(this.content),this.options.loaderImageUrl){t(`<img src="${this.options.loaderImageUrl}" alt="Loading Spinner" />`).appendTo(this.calendarLoader)}},_processLegend:function(){this.legend=t("<div/>"),this._addClass(this.legend,"mega-legend"),this.legend.appendTo(this.content),this.legendHeader=t("<div/>"),this.legendHeader.html("Legend"),this._addClass(this.legendHeader,"mega-legend-header"),this.legendHeader.appendTo(this.legend),this.legendBody=t("<div/>"),this._addClass(this.legendBody,"mega-legend-body"),this.legendBody.appendTo(this.legend),this._processLegendItem("icon-bullhorn","Event is Published")},_processLegendItem:function(e,o){const n=t("<div/>");this._addClass(n,"mega-legend-items"),n.appendTo(this.legendBody);const a=t("<div/>");this._addClass(a,"mega-legend-item"),a.appendTo(n);const i=t("<i/>");this._addClass(i,e),i.appendTo(a);const s=t("<div/>");this._addClass(s,"mega-legend-item"),s.appendTo(n);const d=t("<span/>");d.html("="),d.appendTo(s);const r=t("<div/>");this._addClass(r,"mega-legend-item"),r.appendTo(n);const h=t("<span/>");h.html(o),h.appendTo(r)},_processEvents:function(o){this.days.forEach(function(n){const a=e(n.data("date")).format(this.options.dateFormat.eventDate),i=t("div.mega-view-day-content",n);o.forEach(function(o){const{eventDate:n,id:s,title:d,published:r,createdByMe:h,owner:l}=o;if(e(n).format(this.options.dateFormat.eventDate)===a){const n=t("<button />");n.attr({id:`event-${s}`}),n.data("eventData",o),n.appendTo(i),n.attr("tabindex",0);const a=o.category?"event-category-"+o.category.id:"";if(this._addClass(n,`megaEvent mega-view-day-content-event ${a}`,this.eventCurrentClass),this.events.push(n),this.options.showImage){const e=t("<div/>");this._addClass(e,"megaDayImage mega-view-day-content-event-image"),e.appendTo(n);const a=t("<div/>");this._addClass(a,"image-zone"),a.appendTo(e),this._processEventImage(o,e)}else this._addClass(n,"noImageEvent");const m=t("<div/>");if(m.appendTo(n),this.options.showImage?this._addClass(m,"megaEventText mega-view-day-content-event-text","has-image-sibling"):this._addClass(m,"megaEventText mega-view-day-content-event-text","full-height"),this.options.colorOverride.eventBGColor){var c=this.options.colorOverride.eventBGOpacity||.85,p=this._hexToRgba(this.options.colorOverride.eventBGColor,c);m.css({background:p})}if(this.options.colorOverride.eventBorderColor&&m.css({"border-left-color":this.options.colorOverride.eventBorderColor}),r?this._addClass(m,"mega-published-event"):this._addClass(m,"mega-unpublished-event"),h?this._addClass(m,"mega-my-event"):this._addClass(m,"mega-shared-event"),o.startTime){let n=e(o.startTime,"HH:mm").format(this.options.timeFormat);const a=t("<span/>");a.html(n),this._addClass(a,"megaTime time"),this.options.colorOverride.eventTextColor&&a.css({color:this.options.colorOverride.eventTextColor}),a.appendTo(m)}if(d&&"-"!==t.trim(d)){const e=t("<div/>"),o=t("<span/>");if(o.html(t.trim(d)),o.addClass("megaTitlePara"),o.appendTo(e),this._addClass(e,"megaTitle title"),this.options.colorOverride.eventTextColor&&o.css({color:this.options.colorOverride.eventTextColor}),!h&&this.options.showOwners){const t=`Owned by ${l.calendarName} (${l.handle})`;e.attr("title",t)}e.appendTo(m)}if(this.options.showLegends){const e=t("<div/>");if(this._addClass(e,"megaIcons"),e.appendTo(m),r){const o=t("<i/>");this._addClass(o,"icon-bullhorn"),o.attr("aria-hidden",!0),o.appendTo(e);const n=t("<span />");this._addClass(n,"sr-only"),n.html("Published Event"),n.appendTo(m)}}n.on("click",function(t){this._trigger("eventClick",t,{eventId:s,createdByMe:h}),t.stopPropagation()}.bind(this)),n.on("contextmenu",function(t){this._preventEventPropagation(t),this._trigger("eventContextMenu",t,{eventId:s})}.bind(this)),n.on("mouseover focus",function(t){n.is(":hover")&&"focus"==t.type||(this._preventEventPropagation(t),this._trigger("eventHover",t,{eventId:s}))}.bind(this)),n.on("blur",function(t){this._preventEventPropagation(t),this._hideTooltip()}.bind(this))}}.bind(this))}.bind(this))},_processEventImage:function(t,e){const{imageUrl:o,imageUrlSquare:n,imageUrlDetail:a,iamgeUrlBanner:i}=t;let s=o;switch(this.options.eventImageSize){case"square":s=n||o;break;case"detail":s=a||o;break;case"banner":s=i||o;break;default:s=o}s?this._createPanelImageHolder(e,"one-image",s):(this._addClass(e,"noImage"),this._addClass(e.parent(),"noImageEvent"),this.options.defaultEventImageUrl&&this._processPanelDefaultImage(e,this.options.defaultEventImageUrl))},_hideLoader:function(){this._removeClass(this.calendarLoader,"mega-loading-animation","visible")._addClass(this.calendarLoader,"mega-loading-animation","hidden")},_processTooltip:function(){this.tooltip=t("<div/>"),this._addClass(this.tooltip,"mega-tooltip"),this.tooltip.appendTo(this.content),this.tooltip.hide();const e=t("<div/>");this._addClass(e,"arrow-zone bottom"),e.appendTo(this.tooltip);const o=t("<div/>");this._addClass(o,"arrow"),o.appendTo(e);const n=t("<div/>");this._addClass(n,"view"),n.appendTo(this.tooltip);const a=t("<div/>");this._addClass(a,"megaToolContent","hidden"),a.appendTo(n);const i=t("<div/>");if(this._addClass(i,"animation","hidden"),i.appendTo(n),this.options.loaderImageUrl){t(`<img src="${this.options.loaderImageUrl}" alt="Loading Spinner" />`).appendTo(i)}t("body").on("click mouseover",function(e){!1===t(e.target).is(this.tooltip)&&!1===t.contains(this.tooltip.get(0),e.target)&&this._hideTooltip()}.bind(this)),parent.document&&t(parent.document).on("click mouseover",function(t){this._hideTooltip()}.bind(this))},_createTooltipContent:function(t){const e=this.tooltip.find("div.megaToolContent");e.empty(),e.html(t),this._removeClass(e,"megaToolContent","hidden")._addClass(e,"megaToolContent","visible")},_createTooltipPanels:function(t,e){},_processPanelDefaultImage:function(t,e){this._createPanelImageHolder(t,"one-image",e)},_createPanelImageHolder:function(e,o,n){const a=e.find("div.image-zone"),i=t("<div/>");this._addClass(i,o),i.appendTo(a);const s=t("<img/>");s.attr("src",n),s.attr("alt","An image representing the event"),s.appendTo(i)},_hideTooltip:function(){this.popper&&this.popper.destroy(),this.tooltip.hide()},_refresh:function(t){this.calendarBody.remove(),this.toolbarMonth.html(this.startOfMonth.format(this.options.dateFormat.toolbar)),this._processCalendarBody(),this._trigger("calendarViewChange",t,{date:this.startOfMonth.toDate()})},_getCalendarDates:function(){let t=this._getStartOfCalendar(this.startOfMonth),e=this._getEndOfCalendar(this.endOfMonth);const o=[];for(;!t.isAfter(e,"day");)o.push(t.clone()),t=t.add(1,"day");return o},_getStartOfMonth:function(t){return this._resetTime(t.clone().startOf("month"))},_getEndOfMonth:function(t){return this._resetTime(t.clone().endOf("month"))},_getStartOfCalendar:function(t){return this._resetTime(t.clone().startOf("week"))},_getEndOfCalendar:function(t){return this._resetTime(t.clone().endOf("week"))},_resetTime:function(t){return t.hours(0).minutes(0).seconds(0).milliseconds(0)},_preventEventPropagation:function(t){t&&(t.preventDefault(),t.stopPropagation())},_getImageAtSize:function(t,e){return t.replace(/\.([^\.]*)$/,"-"+e+".$1")},_hexToRgba:function(t,e=1){let o=t.replace("#","").toUpperCase();if(!o.match(/[A-F0-9]{3,6}/g))return"";if(3===o.length)for(let t of o)o+=t.repeat(1);const n=o.match(/[A-Fa-f0-9]{2}/g).map((t=>parseInt(t,16))),a=Math.max(Math.min(e,1),0);return`rgba(${n.join(", ")}, ${a})`}})}(jQuery);